# QUARKUS-6969 Use `@QuarkusIntegrationTest` tests as a test run for AOT file generation

JIRA: https://issues.redhat.com/browse/QUARKUS-6969

Use `@QuarkusIntegrationTest` tests as a test run for AOT file generation

Upstream PRs:
- https://github.com/quarkusio/quarkus/pull/50952
- https://github.com/quarkusio/quarkus/pull/50986

Documentation:
- https://quarkus.io/guides/appcds#generate-the-aot-cache-from-integration-tests
- https://quarkus.io/guides/getting-started-testing#generating-an-aot-cache-during-integration-tests

## Scope of testing
The QUARKUS-6969 is adding the possibility to generate AoT (Ahead of Time) cache using the integration tests.
The usage of AoT cache can improve startup time as it's caching the classes state to make classes instantly available.
For more info about AoT cache see [JEP 483](https://openjdk.org/jeps/483), [JEP 514](https://openjdk.org/jeps/514), [JEP 515](https://openjdk.org/jeps/515.
This is part of AoT story tracked in working group 68 (https://github.com/orgs/quarkusio/projects/68) and some other PRs implementing AoT.
When using the AoT cache generated by integration tests, sometime there can be need to executed from its own directory, as there is bug in JDK 25.
This bug is tracked in https://bugs.openjdk.org/browse/JDK-8376576 and the Java 26 and 27 are not affected.

There is some effort to use new type of packaging optimized for AoT as there were some discoveries that `legacy-jar`/`uber-jar` performs better with AoT cache then `fast-jar`.

The AoT is available in Java 24+ so the test coverage will be currently only using Java 25, which is the latest LTS.


## Automated test development
To test that AoT cache file is generated by integration tests and used by Quarkus app, the [getting-started-reactive](https://github.com/quarkusio/quarkus-quickstarts/tree/main/getting-started-reactive) will be used.
In this case there is no need to check the faster startup time as, it would be difficult to see and determine how much faster the startup should be.
The use of quickstart will leverage already created integration tests and at the same the `@QuarkusIntegrationTest` won't be introduced to Quarkus QE TS.
To check that the AoT cache is used by Quarkus app will be started with `-XX:AOTCach` and `-Xlog:aot` while packaged as `uber-jar`.
The `uber-jar` will be used to ensure there is no flakiness caused by [JDK-8376576](https://bugs.openjdk.org/browse/JDK-8376576).
When the [JDK-8376576](https://bugs.openjdk.org/browse/JDK-8376576) is fixed the `fast-jar` should be used as it's default packaging type.

As mentioned the JVM and Java 25 only will be used to test this feature.
Full coverage/support for the support of Java 25 will be described in separate test plan.
To test this feature the Java 25 will be added to GitHub CI in our testsuite.
For product testing the job using Java 25 will be added in future when the RHBQ/IEBQ 3.33 will be introduced to the matrix.
Until then the draft PR will be created to verify the job work as expected.

The OpenShift won't be covered as our FW build the Quarkus app on separate OpenShift pod, and it's not possible to retrieve the file from that pod in case of our FW.

### Impact on TS and resources
The tests will be added to [`external-applications`](https://github.com/quarkus-qe/quarkus-test-suite/tree/main/external-applications) module.

The tests will be executed on bare-metal JVM, using Java 25.
The expected time increase will be in number of minutes as the tests need to download and build one of the quickstart example.

## Contacts
- Tester: Jakub Jedliƒçka <jjedlick@ibm.com>